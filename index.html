<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dani TV - Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</title>
    
    <link rel="stylesheet" href="style.css">
    
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

    <header>
        <img src="logo.png" alt="Dani TV Logo" class="logo">
        <h1>Dani TV</h1>
    </header>

    <div class="container">
        
        <div class="player-container">
            <h2 id="channel-title">Ø§Ø®ØªØ± Ù‚Ù†Ø§Ø© Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„ØªØ¨Ø¯Ø£</h2>
            <video id="videoPlayer" controls autoplay muted></video>
        </div>

        <div class="channel-list-container">
            <h2>ğŸ“º Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‚Ù†ÙˆØ§Øª</h2>
            <input type="text" id="search-bar" onkeyup="filterChannels()" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù‚Ù†Ø§Ø©...">
            <ul id="channel-list">
                <li class="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‚Ù†ÙˆØ§Øª...</li>
            </ul>
        </div>
        
    </div>

    <script>
        const video = document.getElementById('videoPlayer');
        let hls; // Ø³Ù†Ù‚ÙˆÙ… Ø¨Ø¥Ù†Ø´Ø§Ø¦Ù‡ Ù„Ø§Ø­Ù‚Ø§Ù‹

        // *** Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„ØªØµØ­ÙŠØ­: ***
        // Ù„Ù‚Ø¯ Ø£Ø¶ÙÙ†Ø§ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† "Hls.isSupported()" Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
        // Ù„Ù† Ù†Ù‚ÙˆÙ… Ø¨ØªØ´ØºÙŠÙ„ Ø£ÙŠ ÙƒÙˆØ¯ HLS Ø¥Ù„Ø§ Ø¥Ø°Ø§ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø¨Ù†Ø¬Ø§Ø­
        if (Hls.isSupported()) {
            hls = new Hls();
            hls.attachMedia(video);
        } else {
            console.warn("HLS.js ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… Ø£Ùˆ ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„. Ø³Ù†Ø¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù…ØªØµÙØ­.");
        }

        // ÙˆØ¸ÙŠÙØ© Ù„ØªØ´ØºÙŠÙ„ Ù‚Ù†Ø§Ø© Ù…Ø¹ÙŠÙ†Ø©
        function playChannel(name, url, clickedElement) {
            document.getElementById('channel-title').innerText = `Ø£Ù†Øª ØªØ´Ø§Ù‡Ø¯ Ø§Ù„Ø¢Ù†: ${name}`;
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙ…ÙŠÙŠØ² (class 'active') Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚Ù†ÙˆØ§Øª
            const allChannels = document.querySelectorAll('#channel-list li');
            allChannels.forEach(item => item.classList.remove('active'));
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙ…ÙŠÙŠØ² (class 'active') Ù„Ù„Ù‚Ù†Ø§Ø© Ø§Ù„ØªÙŠ ØªÙ… Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„ÙŠÙ‡Ø§
            if (clickedElement) {
                clickedElement.classList.add('active');
            }

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù‚Ø¨Ù„ Ø§Ù„ØªØ´ØºÙŠÙ„
            if (Hls.isSupported() && hls) {
                // Ø¥Ø°Ø§ HLS Ù…Ø¯Ø¹ÙˆÙ…ØŒ Ø§Ø³ØªØ®Ø¯Ù…Ù‡
                hls.loadSource(url);
                hls.on(Hls.Events.MEDIA_ATTACHED, function () {
                    video.play();
                });
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…Ø¯Ø¹ÙˆÙ… (Ù…Ø«Ù„ Safari)ØŒ Ø¯Ø¹ Ø§Ù„Ù…ØªØµÙØ­ ÙŠØ­Ø§ÙˆÙ„
                video.src = url;
                video.addEventListener('loadedmetadata', function () {
                    video.play();
                });
            } else {
                // Ø¥Ø°Ø§ ÙØ´Ù„ ÙƒÙ„ Ø´ÙŠØ¡
                document.getElementById('channel-title').innerText = "Ø®Ø·Ø£: Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ´ØºÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø«";
            }
            
            window.scrollTo(0, 0);
        }

        // ÙˆØ¸ÙŠÙØ© Ù„ØªØ­Ù„ÙŠÙ„ Ù…Ù„Ù m3u
        async function parseM3U(fileUrl) {
            try {
                const response = await fetch(fileUrl);
                if (!response.ok) { // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ù„Ù Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹ (Ù„ÙŠØ³ 404)
                    throw new Error('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù');
                }
                const text = await response.text();
                const lines = text.split('\n');
                
                const channels = [];
                let currentTitle = null;

                for (const line of lines) {
                    if (line.startsWith('#EXTINF:')) {
                        const nameMatch = line.match(/tvg-name="([^"]+)"/);
                        if (nameMatch && nameMatch[1]) {
                            currentTitle = nameMatch[1];
                        } else {
                            currentTitle = line.split(',').pop();
                        }
                    } else if (line.startsWith('http') && currentTitle) {
                        channels.push({ name: currentTitle.trim(), url: line.trim() });
                        currentTitle = null; 
                    }
                }
                return channels;
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ù…Ù„Ù Ø§Ù„Ù‚Ù†ÙˆØ§Øª:', error);
                return [];
            }
        }

        // ÙˆØ¸ÙŠÙØ© Ù„ÙÙ„ØªØ±Ø© (Ø¨Ø­Ø«) Ø§Ù„Ù‚Ù†ÙˆØ§Øª (ÙƒÙ…Ø§ Ù‡ÙŠ)
        function filterChannels() {
            const input = document.getElementById('search-bar');
            const filter = input.value.toUpperCase(); 
            const ul = document.getElementById('channel-list');
            const li = ul.getElementsByTagName('li');

            for (let i = 0; i < li.length; i++) {
                const txtValue = li[i].textContent || li[i].innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    li[i].style.display = "";
                } else {
                    li[i].style.display = "none";
                }
            }
        }

        // Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©ØŒ Ø§Ø¨Ø¯Ø£ Ø¨ÙƒÙ„ Ø´ÙŠØ¡
        document.addEventListener('DOMContentLoaded', async () => {
            const channelListElement = document.getElementById('channel-list');
            const channels = await parseM3U('channels.m3u'); 

            if (channels.length > 0) {
                channelListElement.innerHTML = ''; 
                
                channels.forEach(channel => {
                    const li = document.createElement('li');
                    li.innerText = channel.name;
                    li.onclick = () => playChannel(channel.name, channel.url, li);
                    channelListElement.appendChild(li);
                });
            } else {
                channelListElement.innerHTML = '<li class="loading error">Ù