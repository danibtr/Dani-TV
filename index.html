<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dani TV - Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</title>
    
    <link rel="stylesheet" href="style.css">
    
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

    <header>
        <img src="logo.png" alt="Dani TV Logo" class="logo">
        <h1>Dani TV</h1>
    </header>

    <div class="container">
        
        <div class="player-container">
            <h2 id="channel-title">Ø§Ø®ØªØ± Ù‚Ù†Ø§Ø© Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„ØªØ¨Ø¯Ø£</h2>
            <video id="videoPlayer" controls autoplay muted></video>
            </div>

        <div class="channel-list-container">
            <h2>ğŸ“º Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‚Ù†ÙˆØ§Øª</h2>
            <input type="text" id="search-bar" onkeyup="filterChannels()" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù‚Ù†Ø§Ø©...">
            <ul id="channel-list">
                <li class="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‚Ù†ÙˆØ§Øª...</li>
            </ul>
        </div>
        
    </div>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø´ØºÙ„ HLS.js
        const video = document.getElementById('videoPlayer');
        const hls = new Hls();
        hls.attachMedia(video);

        // ÙˆØ¸ÙŠÙØ© Ù„ØªØ´ØºÙŠÙ„ Ù‚Ù†Ø§Ø© Ù…Ø¹ÙŠÙ†Ø©
        function playChannel(name, url) {
            document.getElementById('channel-title').innerText = `Ø£Ù†Øª ØªØ´Ø§Ù‡Ø¯ Ø§Ù„Ø¢Ù†: ${name}`;
            
            // ØªØ­Ù…ÙŠÙ„ ÙˆØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ø« Ø§Ù„Ø¬Ø¯ÙŠØ¯
            hls.loadSource(url);
            hls.on(Hls.Events.MEDIA_ATTACHED, function () {
                video.play();
            });
            
            // (Ù„Ù„Ù‡ÙˆØ§ØªÙ) ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ø´Ø© Ù„Ù„Ø£Ø¹Ù„Ù‰ Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ù…Ø´ØºÙ„
            window.scrollTo(0, 0);
        }

        // ÙˆØ¸ÙŠÙØ© Ù„ØªØ­Ù„ÙŠÙ„ Ù…Ù„Ù m3u
        async function parseM3U(fileUrl) {
            try {
                const response = await fetch(fileUrl);
                const text = await response.text();
                const lines = text.split('\n');
                
                const channels = [];
                let currentTitle = null;

                for (const line of lines) {
                    if (line.startsWith('#EXTINF:')) {
                        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø©
                        const nameMatch = line.match(/tvg-name="([^"]+)"/);
                        if (nameMatch && nameMatch[1]) {
                            currentTitle = nameMatch[1];
                        } else {
                            // Ø¥Ø°Ø§ Ù„Ù… ÙŠØ¬Ø¯ tvg-nameØŒ ÙŠØ£Ø®Ø° Ø£ÙŠ Ù†Øµ Ø¨Ø¹Ø¯ Ø§Ù„ÙØ§ØµÙ„Ø©
                            currentTitle = line.split(',').pop();
                        }
                    } else if (line.startsWith('http') && currentTitle) {
                        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø³Ø·Ø± Ù‡Ùˆ Ø±Ø§Ø¨Ø· ÙˆÙ…Ø¹Ù‡ Ø¹Ù†ÙˆØ§Ù†
                        channels.push({ name: currentTitle.trim(), url: line.trim() });
                        currentTitle = null; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
                    }
                }
                return channels;
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ù…Ù„Ù Ø§Ù„Ù‚Ù†ÙˆØ§Øª:', error);
                return []; // Ø¥Ø±Ø¬Ø§Ø¹ Ù‚Ø§Ø¦Ù…Ø© ÙØ§Ø±ØºØ© Ø¹Ù†Ø¯ Ø§Ù„ÙØ´Ù„
            }
        }

        // ÙˆØ¸ÙŠÙØ© Ù„ÙÙ„ØªØ±Ø© (Ø¨Ø­Ø«) Ø§Ù„Ù‚Ù†ÙˆØ§Øª
        function filterChannels() {
            const input = document.getElementById('search-bar');
            const filter = input.value.toUpperCase(); 
            const ul = document.getElementById('channel-list');
            const li = ul.getElementsByTagName('li');

            for (let i = 0; i < li.length; i++) {
                const txtValue = li[i].textContent || li[i].innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    li[i].style.display = "";
                } else {
                    li[i].style.display = "none";
                }
            }
        }

        // Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©ØŒ Ø§Ø¨Ø¯Ø£ Ø¨ÙƒÙ„ Ø´ÙŠØ¡
        document.addEventListener('DOMContentLoaded', async () => {
            const channelListElement = document.getElementById('channel-list');
            
            // *** ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ù…ÙŠØ© Ù…Ù„ÙÙƒ channels.m3u ***
            const channels = await parseM3U('channels.m3u'); 

            if (channels.length > 0) {
                channelListElement.innerHTML = ''; // Ø¥ÙØ±Ø§Øº Ø±Ø³Ø§Ù„Ø© "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„"
                
                channels.forEach(channel => {
                    const li = document.createElement('li');
                    li.innerText = channel.name;
                    // Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ù†Ø§Ø©ØŒ Ø´ØºÙ„Ù‡Ø§
                    li.onclick = () => playChannel(channel.name, channel.url);
                    channelListElement.appendChild(li);
                });
            } else {
                // ÙÙŠ Ø­Ø§Ù„ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
                channelListElement.innerHTML = '<li class="loading error">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‚Ù†ÙˆØ§Øª. ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù„Ù channels.m3u</li>';
            }
        });
    </script>

</body>
</html>